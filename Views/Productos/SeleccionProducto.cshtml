@model InventarioWEB.Models.SeleccionProductoModel

@{
    ViewData["Title"] = "Seleccionar Producto";
    Layout = "_Layout"; // ✅ Usa la plantilla principal con menú lateral y estilos globales
}

<div class="container mt-4">
    <h2 class="text-primary fw-bold mb-4 text-center">
        🎯 @ViewData["Title"]
    </h2>

    <div class="card shadow-sm p-4">
        <form asp-action="Seleccionar" method="post">
            <div class="mb-3">
                <label class="form-label fw-semibold">Género</label>
                <select id="ddlGenero" class="form-select" name="ID_Genero">
                    <option value="">-- Seleccione un género --</option>
                    @foreach (var genero in Model.Generos)
                    {
                            <option value="@genero.ID_Genero">@genero.DescripGenero</option>
                    }
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Talla</label>
                <select id="ddlTalla" class="form-select" name="ID_Talla" disabled>
                    <option value="">-- Seleccione primero un género --</option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Tela</label>
                <select id="ddlTela" class="form-select" name="ID_Tela" disabled>
                    <option value="">-- Seleccione primero una talla --</option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Color</label>
                <select id="ddlColor" class="form-select" name="ID_Color" disabled>
                    <option value="">-- Seleccione primero una tela --</option>
                </select>
            </div>

            <div class="text-center mt-4">
                <button type="submit" class="btn btn-success shadow-sm px-4">
                    <i class="bi bi-check-circle"></i> Confirmar Selección
                </button>
                <a asp-controller="Productos" asp-action="Index" class="btn btn-secondary shadow-sm px-4 ms-2">
                    <i class="bi bi-arrow-left-circle"></i> Volver
                </a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <script>
            $(document).ready(function () {

                // 1️⃣ Cargar tallas según el género seleccionado
                $('#ddlGenero').change(function () {
                    var idGenero = $(this).val();
                    limpiarSelects(['#ddlTalla', '#ddlTela', '#ddlColor']);

                    if (!idGenero) return;

                    $.getJSON('@Url.Action("TallasPorGenero", "Referencia")/' + idGenero, function (data) {
                        actualizarSelect('#ddlTalla', data, '-- Seleccione una talla --');
                    });
                });

                // 2️⃣ Cargar telas según talla y género
                $('#ddlTalla').change(function () {
                    var idTalla = $(this).val();
                    var idGenero = $('#ddlGenero').val();
                    limpiarSelects(['#ddlTela', '#ddlColor']);

                    if (!idTalla || !idGenero) return;

                    $.getJSON('@Url.Action("TelasPorTalla", "Referencia")?idTalla=' + idTalla + '&idGenero=' + idGenero, function (data) {
                        actualizarSelect('#ddlTela', data, '-- Seleccione una tela --');
                    });
                });

                // 3️⃣ Cargar colores según tela seleccionada
                $('#ddlTela').change(function () {
                    var idTela = $(this).val();
                    limpiarSelects(['#ddlColor']);

                    if (!idTela) return;

                    $.getJSON('@Url.Action("Colores", "Referencia")?idTela=' + idTela, function (data) {
                        actualizarSelect('#ddlColor', data, '-- Seleccione un color --');
                    });
                });

                // 🧩 Función auxiliar para limpiar selects
                function limpiarSelects(selects) {
                    selects.forEach(function (selector) {
                        $(selector)
                            .prop('disabled', true)
                            .html('<option value="">-- Cargando... --</option>');
                    });
                }

                // 🧩 Función auxiliar para cargar opciones dinámicas
                function actualizarSelect(selector, data, textoDefault) {
                    var options = '<option value="">' + textoDefault + '</option>';
                    $.each(data, function (i, item) {
                        options += '<option value="' + item.id + '">' + item.descripcion + '</option>';
                    });
                    $(selector).html(options).prop('disabled', false);
                }

            });
        </script>
}
