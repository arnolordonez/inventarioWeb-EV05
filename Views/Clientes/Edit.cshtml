@model InventarioWEB.Models.Cliente

@{
    ViewData["Title"] = "Editar Cliente";
    // ViewBag.TiposItems debe ser IEnumerable<SelectListItem>
    var tipos = ViewBag.TiposItems as IEnumerable<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>
                ?? new List<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>
                        {
                    new Microsoft.AspNetCore.Mvc.Rendering.SelectListItem { Text = "Minorista", Value = "Minorista" },
                    new Microsoft.AspNetCore.Mvc.Rendering.SelectListItem { Text = "Mayorista", Value = "Mayorista" }
                        };
}

<h4>Editar Cliente</h4>

<form asp-action="Edit" method="post">
    <input type="hidden" asp-for="ID_Cliente" />

    <div class="row g-3">
        <div class="col-md-6">
            <label asp-for="Nombre" class="form-label">Nombre</label>
            <input asp-for="Nombre" class="form-control" />
            <span asp-validation-for="Nombre" class="text-danger"></span>
        </div>

        <div class="col-md-6">
            <label asp-for="Apellido" class="form-label">Apellido</label>
            <input asp-for="Apellido" class="form-control" />
            <span asp-validation-for="Apellido" class="text-danger"></span>
        </div>

        <div class="col-md-6">
            <label asp-for="Correo" class="form-label">Correo</label>
            <input asp-for="Correo" class="form-control" />
            <span asp-validation-for="Correo" class="text-danger"></span>
        </div>

        <div class="col-md-6">
            <label asp-for="Telefono" class="form-label">Teléfono</label>
            <input asp-for="Telefono" class="form-control" />
            <span asp-validation-for="Telefono" class="text-danger"></span>
        </div>

        <div class="col-md-6">
            <label asp-for="Direccion" class="form-label">Dirección</label>
            <input asp-for="Direccion" class="form-control" />
            <span asp-validation-for="Direccion" class="text-danger"></span>
        </div>

        <div class="col-md-6">
            <label asp-for="CiudadMunicipio" class="form-label">Ciudad / Municipio</label>
            <input asp-for="CiudadMunicipio" class="form-control" />
            <span asp-validation-for="CiudadMunicipio" class="text-danger"></span>
        </div>

        <div class="col-md-6">
            <label asp-for="TipoCliente" class="form-label">Tipo de Cliente</label>
            <select asp-for="TipoCliente" class="form-select" id="tipoClienteSelect"
                    asp-items="tipos">
            </select>
            <span asp-validation-for="TipoCliente" class="text-danger"></span>
        </div>

        <div class="col-md-6">
            <label class="form-label">VIP</label>
            <input type="text" id="vipText" class="form-control" value="@(Model.VIP ? "SI" : "NO")" readonly />
            <input type="hidden" id="VIP" asp-for="VIP" />
        </div>

        <div class="col-12">
            <label asp-for="Observaciones" class="form-label">Observaciones</label>
            <textarea asp-for="Observaciones" class="form-control" rows="3"></textarea>
            <span asp-validation-for="Observaciones" class="text-danger"></span>
        </div>

        <div class="col-md-6">
            <label asp-for="Activo" class="form-label">Activo</label>
            <select asp-for="Activo" class="form-select">
                <option value="true" selected="@(Model.Activo)">SI</option>
                <option value="false" selected="@(Model.Activo == false)">NO</option>
            </select>
        </div>
    </div>

    <div class="mt-3 d-flex justify-content-end">
        <a asp-action="Index" class="btn btn-outline-secondary me-2">Cancelar</a>
        <button type="submit" class="btn btn-primary">Guardar cambios</button>
    </div>
</form>

@section Scripts {
        <partial name="_ValidationScriptsPartial" />
        <script>
            (function () {
                const tipo = document.getElementById('tipoClienteSelect');
                const vipText = document.getElementById('vipText');
                const vipHidden = document.getElementById('VIP');

                function actualizarVIP() {
                    const val = tipo.value;
                    if (val === 'Mayorista') {
                        vipText.value = 'SI';
                        vipHidden.value = true;
                    } else {
                        vipText.value = 'NO';
                        vipHidden.value = false;
                    }
                }

                if (tipo) {
                    tipo.addEventListener('change', actualizarVIP);
                    actualizarVIP();
                }
            })();
        </script>
}
